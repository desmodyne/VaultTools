---
# deploy.yaml
#
# deploy configuration file
#
# author  : stefan schablowski
# contact : stefan.schablowski@desmodyne.com
# created : 2018-12-25


# NOTE: this file is used as configuration file for the deploy CI/CD script,
# copied to the remote host being deployed to and used as conf file there again


# -----------------------------------------------------------------------------
# configuration properties used on local host

# name of remote host
# NOTE: this expects SSH access to be configured in ~/.ssc/config
host_name: contabo

# files to provide at defined (temp) location, ready for use on remote host
files_to_copy:

    # scripts to run on remote host, must be available in local PATH
    script_names:
      - dd-download-cont-images-from-gitlab
      - dd-run-cont-images

    # absolute path to BashLib file used by script
    bashlib_file: /usr/local/lib/dd-bash-lib.sh

    # path to conf file to pass to script, relative project root
    config_file:  cicd/conf/deploy.yaml

    # path to container image configuration, relative to project root
    cont_file:    code/docker/ci-vault-server/Dockerfile

# folder files are provided in for run-remote to pick up
# TODO: use a better path (--> template ?)
local_tmp_dir: /tmp/deploy


# -----------------------------------------------------------------------------
# configuration properties used on remote host

# container namespace used locally when building image
local_namespace: desmodyne

# container namespace used when uploading image to gitlab registry
# NOTE: this goes into the docker registry url and must be all lowercase,
# otherwise tagging the image fails with
#   Error parsing reference: "<repo url>:<tag>" is not a valid repository/tag:
#   invalid reference format: repository name must be lowercase
gitlab_namespace: desmodyne/tools/vaulttools

# gitlab container registry url
gitlab_reg_url: registry.gitlab.com

# https://docs.gitlab.com/ee/user/project/deploy_tokens

# TODO: at some later stage, this script will obtain required credentials from
# an instance of HashiCorp Vault; until then, they can obviously not be stored
# under version control for security reasons; for now, add placeholders to this
# configuration file that cause the deploy script to fail fast and replace them
# locally with the actual credentials, but not commit that to version control

# NOTE: please take care to not submit these credentials to git!

# gitlab container registry username
gitlab_username: "TODO: insert actual username"

# gitlab container registry password
gitlab_password: "TODO: insert actual password"


# list of data sets to configure container images
images:

  # TODO: is there a need to deploy the client image ?

  # name of the container image
  # ci-vault-client:
  #
  #   # name of container when run off image
  #   cont_name: ct-vault-client
  #
  #   # container image tag
  #   image_tag: latest
  #
  #   # network name; must match nginx / nginx-le network name;
  #   # see InfoSec/Lets Encrypt/code/docker/cc-nginx-proxy/docker-compose.yml
  #   network_name: net-nginx-proxy

  ci-vault-server:
    cont_name: ct-vault-server
    image_tag: latest
    network_name: net-nginx-proxy
