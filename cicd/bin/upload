#!/usr/bin/env bash

# upload
#
# upload all artifacts of this project
#
# author  : stefan schablowski
# contact : stefan.schablowski@desmodyne.com
# created : 2017-05-26


# NOTE: see build script for some possibly informative comments


echo
echo 'upload project artifacts'
echo


# -----------------------------------------------------------------------------
# configure script parameters

# path from this script to project root
path_to_proj_root='../..'

# absolute path to this script: http://stackoverflow.com/a/9107028
here="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# path to BashLib library file, relative to project root
path_to_bashlib='ext/BashLib/code/lib/bashlib.sh'

# path to Docker scripts, relative to project root
path_to_docker_bin='../../Infrastructure/Services/Infrastructure/Docker/code/bin'

# absolute, canonical path to project root
path_to_proj_root="$( realpath "${here}/${path_to_proj_root}")"

# absolute, canonical path to BashLib library file
path_to_bashlib="$(   realpath "${path_to_proj_root}/${path_to_bashlib}")"

# absolute, canonical path to Docker scripts
path_to_docker_bin="$(realpath "${path_to_proj_root}/${path_to_docker_bin}")"

# array with alphabetical list of tools called by this script
# shellcheck disable=SC2034
req_tools=('upload-cont-images-to-gitlab')

# array with paths to append to PATH
# shellcheck disable=SC2034
ext_paths=("${path_to_docker_bin}")


# -----------------------------------------------------------------------------
# load BashLib

# shellcheck disable=SC1090
if ! output="$(source "${path_to_bashlib}" 2>&1)"
then
    echo "${output}"
    exit 1
fi

# shellcheck disable=SC1090
source "${path_to_bashlib}"


# -----------------------------------------------------------------------------
# run BashLib boilerplate functions

if ! configure_platform              ; then exit 1; fi
if ! extend_path req_tools ext_paths ; then exit 1; fi
if ! proc_cmd_line_args "${@}"       ; then exit 1; fi


# -----------------------------------------------------------------------------
# call the other scripts in the designated order

# shellcheck disable=SC2154
if ! upload-cont-images-to-gitlab "${conf_file}"; then exit 1; fi


echo 'project artifacts upload complete'
echo
