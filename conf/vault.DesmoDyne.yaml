---
# vault.<organization>.yaml
#
# <organization> YAML configuration file for HashiCorp vault scripts
#
# author  : stefan schablowski
# contact : stefan.schablowski@desmodyne.com
# created : 2018-02-19


# TODO: align with PKI scripts, get these two from Ansible group vars

# name of management user
mgmt_user_name: ansible

# name of the organization this is used for
organization: DesmoDyne

# vault host
# https protocol / port 443 are implied
vault_host: vault.desmodyne.com

# path to vault log file on its host
path_to_log_file: /var/log/vault/audit.log

# absolute path to secure location with ssh keys and token info
path_to_sec_loc: /Volumes/VAULT/Corporate/DesmoDyne/Secrets/vault.desmodyne.com

# absolute path to folder with user ssh keys
path_to_pki_folder: /Volumes/VAULT/Corporate/DesmoDyne/Secrets/PKI

# name of file with keys to unseal vault, relative to path_to_sec_loc
key_file_name: init.json

# path to folder with policy files, relative to path_to_sec_loc
policies_folder: policies

# path to folder with secrets config files, relative to path_to_sec_loc
# TODO: really mix service and user secret files in the same folder ?
secrets_folder: secrets

# path to folder with users config files, relative to path_to_sec_loc
users_folder: users

# password placeholder string
placeholder: TODO

# secrets to be created in vault
secrets:

# secrets to be created for services
- context: service

  # a sec_conf is a path into vault and secrets stored under it
  sec_confs:

  # path into vault secrets underneath each
  # service's area secret/service/<service name>/<application name>
  # TODO: it might not be safe to store secrets keys in conf

  - path: postgres_sonarqube
    secrets:
    - admin_password
    - reader_password
    - user_password
    - root_password

# secrets to be created for every user
# TODO: review this vs. users section
- context: user

  # a sec_conf is a path into vault and secrets stored under it
  sec_confs:

  # path into vault secrets underneath each user's area secret/user/<username>

  # path is empty --> secrets are stored at secret/user/<username> "root"
  - path:
    secrets:
    - password
    - private_key
    - public_key

  - path: shared_users/ansible
    secrets:
    - password
    - private_key
    - public_key

# services - TODO: is this required ?
services:
- name: postgres_sonarqube

# users to be created in vault for userpass auth method
users:

# policies in vault:
# https://www.vaultproject.io/intro/getting-started/policies.html
# https://www.vaultproject.io/docs/concepts/policies.html
# https://www.vaultproject.io/guides/configuration/policies.html

# NOTE: regular users will be assigned a policy
# at runtime that has the same name as the user

- name: ssc
  policies:
  - default

- name: test
  policies:
  - default

# https://www.vaultproject.io/api/system/init.html#parameters

# number of shares to split the master key into
secret_shares: 5

# number of shares required to reconstruct the master key
secret_threshold: 3
